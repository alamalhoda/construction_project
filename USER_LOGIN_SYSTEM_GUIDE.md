# 🔐 راهنمای سیستم لاگین کاربران نهایی

## 📋 فهرست مطالب
1. [شروع سریع](#شروع-سریع)
2. [صفحات ایجاد شده](#صفحات-ایجاد-شده)
3. [نحوه استفاده](#نحوه-استفاده)
4. [امنیت](#امنیت)
5. [عیب‌یابی](#عیب\u200cیابی)

## 🚀 شروع سریع

### 1. دسترسی به سیستم
```
صفحه اصلی: http://127.0.0.1:8000/
صفحه لاگین: http://127.0.0.1:8000/construction/login/
صفحه ثبت نام: http://127.0.0.1:8000/construction/register/
```

### 2. ایجاد کاربر جدید
- به صفحه ثبت نام بروید
- اطلاعات خود را وارد کنید
- حساب کاربری جدید ایجاد کنید

### 3. ورود به سیستم
- نام کاربری و رمز عبور را وارد کنید
- به داشبورد کاربری هدایت می‌شوید

## 📄 صفحات ایجاد شده

### ✅ صفحات اصلی:
1. **صفحه اصلی** (`/`):
   - نمایش وضعیت ورود کاربر
   - دکمه‌های ورود و ثبت نام
   - دسترسی به پنل ادمین و API

2. **صفحه لاگین** (`/construction/login/`):
   - فرم ورود با نام کاربری و رمز عبور
   - گزینه "مرا به خاطر بسپار"
   - لینک‌های ثبت نام و فراموشی رمز عبور

3. **صفحه ثبت نام** (`/construction/register/`):
   - فرم ثبت نام کامل
   - اعتبارسنجی رمز عبور
   - راهنمای الزامات رمز عبور

4. **داشبورد کاربری** (`/construction/dashboard/`):
   - نمایش اطلاعات کاربر
   - دسترسی به تمام بخش‌های سیستم
   - عملیات کاربری (پروفایل، تغییر رمز، خروج)

### ✅ صفحات محافظت شده:
- **مدیریت پروژه‌ها**: `/construction/Project/`
- **مدیریت سرمایه‌گذاران**: `/construction/Investor/`
- **مدیریت تراکنش‌ها**: `/construction/Transaction/`
- **مدیریت واحدها**: `/construction/Unit/`
- **رابط HTMX**: `/construction/htmx/`

## 🎯 نحوه استفاده

### برای کاربران جدید:
1. **ثبت نام**:
   ```
   http://127.0.0.1:8000/construction/register/
   ```
   - نام و نام خانوادگی
   - نام کاربری (منحصر به فرد)
   - ایمیل
   - رمز عبور (حداقل 8 کاراکتر)

2. **ورود به سیستم**:
   ```
   http://127.0.0.1:8000/construction/login/
   ```
   - نام کاربری و رمز عبور
   - گزینه "مرا به خاطر بسپار"

3. **استفاده از سیستم**:
   - دسترسی به داشبورد
   - مدیریت پروژه‌ها و سرمایه‌گذاران
   - مشاهده گزارش‌ها و آمار

### برای کاربران موجود:
1. **ورود مستقیم**:
   ```
   http://127.0.0.1:8000/construction/login/
   ```

2. **دسترسی به داشبورد**:
   ```
   http://127.0.0.1:8000/construction/dashboard/
   ```

## 🛡️ امنیت

### ✅ ویژگی‌های امنیتی:
1. **احراز هویت اجباری**: همه صفحات محافظت شده نیاز به ورود دارند
2. **Session Management**: مدیریت خودکار جلسات کاربری
3. **Password Validation**: اعتبارسنجی قوی رمز عبور
4. **CSRF Protection**: محافظت در برابر حملات CSRF
5. **Audit Logging**: ثبت تمام فعالیت‌های کاربران

### 🔒 محافظت از صفحات:
- **صفحات محافظت شده**: نیاز به احراز هویت
- **صفحات عمومی**: بدون نیاز به ورود
- **هدایت خودکار**: کاربران غیرمجاز به صفحه لاگین هدایت می‌شوند

### 📊 لاگ‌های امنیتی:
- ورود و خروج موفق
- تلاش‌های ورود ناموفق
- دسترسی‌های غیرمجاز
- تغییرات رمز عبور

## 🔧 فایل‌های ایجاد شده

### 📁 Templates:
- `construction/templates/construction/user_login.html` - صفحه لاگین
- `construction/templates/construction/user_register.html` - صفحه ثبت نام
- `construction/templates/construction/user_dashboard.html` - داشبورد کاربری

### 📁 Views:
- `construction/user_views.py` - View های مربوط به کاربران

### 📁 Middleware:
- `construction/user_middleware.py` - محافظت از صفحات

### 📁 URLs:
- `construction/urls.py` - مسیرهای مربوط به کاربران

## 🚨 عیب‌یابی

### مشکل 1: خطای 500 در صفحه لاگین
**علت**: مشکل در import یا template
**راه‌حل**:
```bash
# بررسی Django
python manage.py check

# بررسی import
python manage.py shell -c "from construction.user_views import user_login_view"
```

### مشکل 2: کاربر نمی‌تواند وارد شود
**علت**: نام کاربری یا رمز عبور اشتباه
**راه‌حل**:
- بررسی نام کاربری و رمز عبور
- استفاده از پنل ادمین برای ایجاد کاربر جدید

### مشکل 3: هدایت به صفحه لاگین
**علت**: کاربر وارد نشده است
**راه‌حل**:
- ابتدا وارد شوید
- سپس به صفحه مورد نظر بروید

### مشکل 4: Session منقضی شده
**علت**: عدم فعالیت برای مدت طولانی
**راه‌حل**:
- دوباره وارد شوید
- از گزینه "مرا به خاطر بسپار" استفاده کنید

## 📋 دستورات مفید

### ایجاد کاربر جدید از پنل ادمین:
```bash
python manage.py createsuperuser
```

### بررسی کاربران موجود:
```bash
python manage.py shell -c "from django.contrib.auth.models import User; print([u.username for u in User.objects.all()])"
```

### پاک کردن session ها:
```bash
python manage.py clearsessions
```

## 🎉 خلاصه

### ✅ کارهای انجام شده:
1. **سیستم لاگین کامل**: صفحه ورود، ثبت نام، و داشبورد
2. **احراز هویت امن**: محافظت از صفحات و API ها
3. **رابط کاربری زیبا**: طراحی مدرن و کاربرپسند
4. **مدیریت Session**: کنترل جلسات کاربری
5. **لاگ‌های امنیتی**: ثبت تمام فعالیت‌ها

### 🌐 آدرس‌های مهم:
```
✅ صفحه اصلی: http://127.0.0.1:8000/
✅ لاگین: http://127.0.0.1:8000/construction/login/
✅ ثبت نام: http://127.0.0.1:8000/construction/register/
✅ داشبورد: http://127.0.0.1:8000/construction/dashboard/
✅ پنل ادمین: http://127.0.0.1:8000/admin/
✅ API لاگین: http://127.0.0.1:8000/construction/api/login/
```

### 🎯 نتیجه:
**✅ سیستم لاگین کاربران نهایی آماده است!**

کاربران می‌توانند:
- حساب کاربری جدید ایجاد کنند
- وارد سیستم شوند
- از تمام امکانات سیستم استفاده کنند
- به صورت امن از سیستم خارج شوند

---

**🎉 حالا کاربران نهایی می‌توانند از سیستم استفاده کنند!**
