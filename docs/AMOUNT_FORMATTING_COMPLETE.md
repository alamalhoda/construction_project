# مستندات کامل فرمت‌بندی مبالغ عددی

## خلاصه کارهای انجام شده

### 1. فایل‌های ایجاد شده
- ✅ `static/js/amount-formatter.js` - توابع JavaScript برای فرمت‌بندی
- ✅ `static/css/amount-formatter.css` - استایل‌های CSS برای فیلدهای عددی

### 2. فایل‌های به‌روزرسانی شده
- ✅ `templates/base.html` - اضافه کردن فایل‌های JS و CSS
- ✅ `construction/templates/construction/sale_form.html` - فیلد amount
- ✅ `construction/templates/construction/unit_form.html` - فیلدهای area, price_per_meter, total_price

### 3. توابع JavaScript

#### `formatAmount(input)`
برای اعداد صحیح (بدون اعشار):
- حذف کاراکترهای غیرعددی
- تبدیل اعداد فارسی به انگلیسی
- فرمت‌بندی با جداکننده هزارگان: `1000000` → `1,000,000`

#### `formatNumber(input)`
برای اعداد اعشاری:
- حذف کاراکترهای غیرعددی (به جز نقطه)
- تبدیل اعداد فارسی به انگلیسی
- فرمت‌بندی با جداکننده هزارگان فقط برای قسمت صحیح: `1000000.50` → `1,000,000.50`
- حفظ اعشار بدون جداکننده

#### `validateAmount(input)` و `validateNumber(input)`
اعتبارسنجی فیلدها و تغییر رنگ border:
- سبز (#28a745) برای مقادیر معتبر
- قرمز (#dc3545) برای مقادیر نامعتبر

#### `removeAllFormatting()`
حذف جداکننده‌ها قبل از ارسال فرم:
- `1,000,000.50` → `1000000.50`
- تضمین ارسال مقدار صحیح به سرور

#### `formatAllNumberInputs()`
فرمت‌بندی اولیه هنگام بارگذاری صفحه:
- فرمت‌بندی فیلدهای `type="text"`
- حذف کاماها از فیلدهای `type="number"`

### 4. استایل‌های CSS

```css
input[name*="amount"],
input[name*="price"],
input[name*="weight"],
input[name*="rate"],
input[name*="infrastructure"],
input[name*="percentage"] {
    direction: ltr !important;
    text-align: left !important;
    font-family: 'Courier New', monospace !important;
}
```

### 5. نحوه استفاده در فرم‌ها

#### برای اعداد صحیح (مبلغ‌ها):
```html
<input type="text" name="amount" 
       placeholder="مثال: 1000000" 
       oninput="formatNumber(this)"
       onblur="validateNumber(this)"
       value="{{ form.amount.value|default:'' }}">
```

#### برای اعداد اعشاری (وزن، نرخ، درصد):
```html
<input type="text" name="weight" 
       placeholder="مثال: 1.5" 
       oninput="formatNumber(this)"
       onblur="validateNumber(this)"
       value="{{ form.weight.value|default:'' }}">
```

### 6. ویژگی‌های پیاده‌سازی شده

- ✅ **فرمت‌بندی اولیه**: هنگام بارگذاری صفحه
- ✅ **فرمت‌بندی هنگام تایپ**: `oninput="formatNumber(this)"`
- ✅ **حفظ موقعیت کرسر**: کاربر می‌تواند در وسط عدد تایپ کند
- ✅ **جداکننده هزارگان**: فقط برای قسمت صحیح
- ✅ **حفظ اعشار**: بدون جداکننده
- ✅ **تبدیل اعداد فارسی**: `۱۲۳۴۵۶۷۸۹` → `123,456,789`
- ✅ **حذف فرمت قبل از ارسال**: ارسال اعداد خام به سرور
- ✅ **پشتیبانی از فیلدهای text و number**: بدون خطای کنسول
- ✅ **جهت چپ به راست**: `direction: ltr` برای همه فیلدهای عددی

### 7. مثال‌های کاربردی

#### مثال 1: فیلد مبلغ
```
ورودی کاربر: 1000000
نمایش: 1,000,000
ارسال به سرور: 1000000
```

#### مثال 2: فیلد مبلغ با اعشار
```
ورودی کاربر: 1000000.50
نمایش: 1,000,000.50
ارسال به سرور: 1000000.50
```

#### مثال 3: فیلد وزن
```
ورودی کاربر: 1.5
نمایش: 1.5
ارسال به سرور: 1.5
```

### 8. نکات مهم

1. **حذف `onfocus="removeFormatting(this)"`**: جداکننده‌ها هنگام کلیک حذف نمی‌شوند
2. **استفاده از `oninput` به جای `onkeyup`**: فرمت‌بندی خودکار هنگام تایپ
3. **حفظ موقعیت کرسر**: فقط برای فیلدهای `type="text"`
4. **محدودیت 12 رقم**: برای اعداد صحیح
5. **محدودیت 10 رقم**: برای قسمت اعشاری

### 9. خلاصه

این پیاده‌سازی تمام نیازهای فرمت‌بندی مبالغ عددی را برآورده می‌کند:
- فرمت‌بندی خودکار
- حفظ اعشار
- حذف فرمت قبل از ارسال
- پشتیبانی از اعداد فارسی
- تجربه کاربری بهتر

