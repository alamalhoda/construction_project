<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª API Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            direction: rtl;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .test-item {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .test-item h3 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .test-item.success {
            border-color: #4CAF50;
            background-color: #f1f8e9;
        }
        
        .test-item.error {
            border-color: #f44336;
            background-color: #ffebee;
        }
        
        .test-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #1976D2;
        }
        
        .test-button.success {
            background: #4CAF50;
        }
        
        .test-button.error {
            background: #f44336;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .summary {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .summary h2 {
            color: #1976d2;
            margin-top: 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1976d2;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª ØªØ³Øª API Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h1>
        
        <div class="summary">
            <h2>Ø®Ù„Ø§ØµÙ‡ ÙˆØ¶Ø¹ÛŒØª API Ù‡Ø§</h2>
            <div class="stats-grid" id="apiStats">
                <div class="stat-item">
                    <div class="stat-number" id="totalApis">0</div>
                    <div class="stat-label">Ú©Ù„ API Ù‡Ø§</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="workingApis">0</div>
                    <div class="stat-label">API Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="failedApis">0</div>
                    <div class="stat-label">API Ù‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalRecords">0</div>
                    <div class="stat-label">Ú©Ù„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§</div>
                </div>
            </div>
        </div>
        
        <div class="test-item">
            <h3>1. ØªØ³Øª API ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h3>
            <button class="test-button" onclick="testTransactionsAPI()">ØªØ³Øª API ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</button>
            <button class="test-button" onclick="testTransactionStatistics()">ØªØ³Øª Ø¢Ù…Ø§Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</button>
            <div id="transactionsResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>2. ØªØ³Øª API Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù†</h3>
            <button class="test-button" onclick="testInvestorsAPI()">ØªØ³Øª API Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù†</button>
            <button class="test-button" onclick="testInvestorSummary()">ØªØ³Øª Ø®Ù„Ø§ØµÙ‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù†</button>
            <div id="investorsResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>3. ØªØ³Øª API Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</h3>
            <button class="test-button" onclick="testProjectsAPI()">ØªØ³Øª API Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</button>
            <div id="projectsResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>4. ØªØ³Øª API Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§</h3>
            <button class="test-button" onclick="testPeriodsAPI()">ØªØ³Øª API Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§</button>
            <div id="periodsResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>5. ØªØ³Øª Ú©Ø§Ù…Ù„ ØªÙ…Ø§Ù… API Ù‡Ø§</h3>
            <button class="test-button success" onclick="testAllAPIs()">ØªØ³Øª Ú©Ø§Ù…Ù„ ØªÙ…Ø§Ù… API Ù‡Ø§</button>
            <div id="allApisResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>6. ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ ØµÙØ­Ù‡</h3>
            <button class="test-button" onclick="testPagePerformance()">ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ ØµÙØ­Ù‡</button>
            <div id="performanceResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = '/construction/api/v1/';
        let apiResults = {};
        
        async function testAPI(endpoint, resultId, description) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.textContent = `Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª ${description}...`;
            
            try {
                const startTime = performance.now();
                const response = await fetch(API_BASE + endpoint);
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                
                const data = await response.json();
                
                if (response.ok) {
                    const recordCount = Array.isArray(data) ? data.length : 1;
                    const sampleData = Array.isArray(data) ? data.slice(0, 2) : data;
                    
                    resultDiv.textContent = `âœ… Ù…ÙˆÙÙ‚ÛŒØª!\n
ğŸ“Š ${description}:
â€¢ ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§: ${recordCount}
â€¢ Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®: ${responseTime.toFixed(2)}ms
â€¢ ÙˆØ¶Ø¹ÛŒØª: ${response.status} - ${response.statusText}

ğŸ“‹ Ù†Ù…ÙˆÙ†Ù‡ Ø¯Ø§Ø¯Ù‡:
${JSON.stringify(sampleData, null, 2)}`;
                    
                    resultDiv.parentElement.className = 'test-item success';
                    apiResults[endpoint] = { success: true, count: recordCount, time: responseTime };
                } else {
                    resultDiv.textContent = `âŒ Ø®Ø·Ø§: ${response.status} - ${response.statusText}`;
                    resultDiv.parentElement.className = 'test-item error';
                    apiResults[endpoint] = { success: false, error: response.statusText };
                }
            } catch (error) {
                resultDiv.textContent = `âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ${error.message}`;
                resultDiv.parentElement.className = 'test-item error';
                apiResults[endpoint] = { success: false, error: error.message };
            }
            
            updateApiStats();
        }
        
        function testTransactionsAPI() {
            testAPI('Transaction/', 'transactionsResult', 'API ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§');
        }
        
        function testTransactionStatistics() {
            testAPI('Transaction/statistics/', 'transactionsResult', 'Ø¢Ù…Ø§Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§');
        }
        
        function testInvestorsAPI() {
            testAPI('Investor/', 'investorsResult', 'API Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù†');
        }
        
        function testInvestorSummary() {
            testAPI('Investor/summary/', 'investorsResult', 'Ø®Ù„Ø§ØµÙ‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù†');
        }
        
        function testProjectsAPI() {
            testAPI('Project/', 'projectsResult', 'API Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§');
        }
        
        function testPeriodsAPI() {
            testAPI('Period/', 'periodsResult', 'API Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§');
        }
        
        async function testAllAPIs() {
            const resultDiv = document.getElementById('allApisResult');
            resultDiv.textContent = 'Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª ØªÙ…Ø§Ù… API Ù‡Ø§...';
            
            const apis = [
                { endpoint: 'Transaction/', name: 'ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§' },
                { endpoint: 'Transaction/statistics/', name: 'Ø¢Ù…Ø§Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§' },
                { endpoint: 'Investor/', name: 'Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù†' },
                { endpoint: 'Investor/summary/', name: 'Ø®Ù„Ø§ØµÙ‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù†' },
                { endpoint: 'Project/', name: 'Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§' },
                { endpoint: 'Period/', name: 'Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§' }
            ];
            
            const results = [];
            
            for (const api of apis) {
                try {
                    const startTime = performance.now();
                    const response = await fetch(API_BASE + api.endpoint);
                    const endTime = performance.now();
                    const responseTime = endTime - startTime;
                    
                    if (response.ok) {
                        const data = await response.json();
                        const recordCount = Array.isArray(data) ? data.length : 1;
                        results.push(`âœ… ${api.name}: ${recordCount} Ø±Ú©ÙˆØ±Ø¯ (${responseTime.toFixed(2)}ms)`);
                    } else {
                        results.push(`âŒ ${api.name}: Ø®Ø·Ø§ ${response.status}`);
                    }
                } catch (error) {
                    results.push(`âŒ ${api.name}: Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡`);
                }
            }
            
            resultDiv.textContent = `Ù†ØªØ§ÛŒØ¬ ØªØ³Øª ØªÙ…Ø§Ù… API Ù‡Ø§:\n\n${results.join('\n')}`;
            resultDiv.parentElement.className = 'test-item success';
        }
        
        function testPagePerformance() {
            const resultDiv = document.getElementById('performanceResult');
            
            const performance = {
                'User Agent': navigator.userAgent,
                'Language': navigator.language,
                'Online': navigator.onLine,
                'Memory': performance.memory ? `${Math.round(performance.memory.usedJSHeapSize / 1024 / 1024)}MB / ${Math.round(performance.memory.totalJSHeapSize / 1024 / 1024)}MB` : 'Ù†Ø§Ù…Ø´Ø®Øµ',
                'Connection': navigator.connection ? navigator.connection.effectiveType : 'Ù†Ø§Ù…Ø´Ø®Øµ',
                'Screen Resolution': `${screen.width}x${screen.height}`,
                'Viewport': `${window.innerWidth}x${window.innerHeight}`,
                'Device Pixel Ratio': window.devicePixelRatio,
                'Local Storage': typeof localStorage !== 'undefined' ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯',
                'Session Storage': typeof sessionStorage !== 'undefined' ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯',
                'Fetch API': typeof fetch !== 'undefined' ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯',
                'Promise': typeof Promise !== 'undefined' ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯',
                'Async/Await': (async () => {}).constructor.name === 'AsyncFunction' ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯'
            };
            
            const results = Object.entries(performance).map(([key, value]) => 
                `${key}: ${value}`
            ).join('\n');
            
            resultDiv.textContent = `ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø±ÙˆØ±Ú¯Ø±:\n\n${results}`;
            resultDiv.parentElement.className = 'test-item success';
        }
        
        function updateApiStats() {
            const totalApis = Object.keys(apiResults).length;
            const workingApis = Object.values(apiResults).filter(r => r.success).length;
            const failedApis = totalApis - workingApis;
            const totalRecords = Object.values(apiResults)
                .filter(r => r.success && r.count)
                .reduce((sum, r) => sum + r.count, 0);
            
            document.getElementById('totalApis').textContent = totalApis;
            document.getElementById('workingApis').textContent = workingApis;
            document.getElementById('failedApis').textContent = failedApis;
            document.getElementById('totalRecords').textContent = totalRecords;
        }
        
        // ØªØ³Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
        window.addEventListener('load', function() {
            console.log('ØµÙØ­Ù‡ ØªØ³Øª API Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
            console.log('Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ú©Ø§Ù…Ù„ØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯');
        });
    </script>
</body>
</html>
