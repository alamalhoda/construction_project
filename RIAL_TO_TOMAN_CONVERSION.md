# راهنمای تبدیل ریال به تومان

## 📋 توضیحات

این اسکریپت تمام فیلدهای رقمی موجود در دیتابیس را از ریال به تومان تبدیل می‌کند (تقسیم بر ۱۰).

## 🎯 فیلدهای تبدیل شونده

### مدل‌های تبدیل شونده:
- **Unit**: `price_per_meter`, `total_price` (قیمت هر متر، قیمت کل)
- **Transaction**: `amount` (مبلغ تراکنش)
- **Expense**: `amount` (مبلغ هزینه)
- **Sale**: `amount` (مبلغ فروش)

### مدل‌های غیر تبدیل شونده:
- **InterestRate**: `rate` (نرخ سود - درصد است، نیازی به تبدیل ندارد)

## 📊 تأثیر بر نمودارها و نمایش

### تغییرات لازم در فایل‌های HTML:
پس از اجرای اسکریپت تبدیل، باید متغیر `BASE_AMOUNT` در فایل‌های زیر تغییر کند:

- **dashboard/view/project_dashboard.html**: `BASE_AMOUNT` از `10000000` به `1000000` تغییر کند
- **dashboard/view/investor_profile.html**: `BASE_AMOUNT` از `10000000` به `1000000` تغییر کند

### دلیل این تغییر:
- **قبل از تبدیل**: اعداد در دیتابیس به ریال بودند و `BASE_AMOUNT = 10000000` (10 میلیون ریال) برای تبدیل به میلیون تومان استفاده می‌شد
- **بعد از تبدیل**: اعداد در دیتابیس به تومان تبدیل می‌شوند (تقسیم بر 10) و باید `BASE_AMOUNT = 1000000` (1 میلیون تومان) باشد

## ⚠️ مراحل کامل تبدیل

### مرحله 1: بکاپ گیری
```bash
source env/bin/activate
python3 manage.py convert_rial_to_toman --backup
```

### مرحله 2: اجرای تبدیل
```bash
source env/bin/activate
python3 manage.py convert_rial_to_toman
```

### مرحله 3: به‌روزرسانی فایل‌های HTML
پس از اجرای موفقیت‌آمیز اسکریپت، فایل‌های زیر باید به‌روزرسانی شوند:

1. **dashboard/view/project_dashboard.html** - خط 1178:
   ```javascript
   // قبل: const BASE_AMOUNT = 10000000;
   // بعد: const BASE_AMOUNT = 1000000;
   ```

2. **dashboard/view/investor_profile.html** - خط 1111:
   ```javascript
   // قبل: const BASE_AMOUNT = 10000000;
   // بعد: const BASE_AMOUNT = 1000000;
   ```

### مرحله 4: تست نمودارها
پس از تغییرات، نمودارها باید به درستی نمایش داده شوند و اعداد در میلیون تومان نشان داده شوند.

## 🚀 روش‌های اجرا

### 1. استفاده از Django Management Command

```bash
# فعال‌سازی محیط مجازی
source env/bin/activate

# تست (حالت آزمایشی) - توصیه می‌شود
python3 manage.py convert_rial_to_toman --dry-run

# تبدیل با بکاپ
python3 manage.py convert_rial_to_toman --backup

# تبدیل مستقیم (بدون بکاپ)
python3 manage.py convert_rial_to_toman
```

### 2. استفاده از اسکریپت Python

```bash
# فعال‌سازی محیط مجازی
source env/bin/activate

# تست
python3 scripts/convert_rial_to_toman.py test

# تبدیل با بکاپ
python3 scripts/convert_rial_to_toman.py backup

# تبدیل مستقیم
python3 scripts/convert_rial_to_toman.py convert
```

### 3. استفاده از اسکریپت Bash

```bash
# تست
./scripts/convert_rial_to_toman.sh test

# تبدیل با بکاپ
./scripts/convert_rial_to_toman.sh backup

# تبدیل مستقیم
./scripts/convert_rial_to_toman.sh convert
```

## ⚠️ نکات مهم

### قبل از اجرا:
1. **حتماً بکاپ بگیرید** از دیتابیس
2. **ابتدا تست کنید** با `--dry-run` یا `test`
3. **در سرور** حتماً از `--backup` استفاده کنید

### ویژگی‌های امنیتی:
- استفاده از Django transactions (atomic operations)
- امکان rollback در صورت خطا
- نمایش جزئیات تمام تغییرات
- ایجاد بکاپ خودکار (در صورت انتخاب)

## 📊 نمونه خروجی

```
💰 شروع تبدیل ریال به تومان
==================================================
🔍 حالت آزمایشی: هیچ تغییری اعمال نخواهد شد

🏠 تبدیل واحدها...
  🏠 واحد A1: قیمت/متر 5000000.00 → 500000.00, قیمت کل 50000000.00 → 5000000.00

💳 تبدیل تراکنش‌ها...
  💳 علی احمدی - آورده: 1000000.00 → 100000.00
  ... و 15 تراکنش دیگر

💸 تبدیل هزینه‌ها...
  💸 مدیر پروژه - 1403/01: 2000000.00 → 200000.00
  ... و 8 هزینه دیگر

🛒 تبدیل فروش‌ها...
  🛒 پروژه نمونه - 1403/01: 500000.00 → 50000.00

📈 بررسی نرخ‌های سود...
  📈 1 نرخ سود یافت شد (نیازی به تبدیل ندارند - درصد هستند)

📊 آمار تبدیل:
==============================
  📋 units: 5 رکورد
  📋 transactions: 20 رکورد
  📋 expenses: 12 رکورد
  📋 sales: 3 رکورد

🎯 مجموع: 40 رکورد تبدیل شد

💡 نمونه مقادیر تبدیل شده:
  🔸 ریال 1,000,000 → تومان 100,000
  🔸 ریال 50,000 → تومان 5,000
  🔸 ریال 2,500 → تومان 250

⚠️ حالت آزمایشی - هیچ تغییری اعمال نشد
```

## 🔄 بازگردانی تغییرات

اگر نیاز به بازگردانی تغییرات دارید:

1. **از بکاپ استفاده کنید** (اگر بکاپ گرفته‌اید)
2. **یا اسکریپت معکوس** ایجاد کنید (ضرب در ۱۰)

## 📞 پشتیبانی

در صورت بروز مشکل:
1. لاگ‌های خطا را بررسی کنید
2. بکاپ را بازگردانی کنید
3. با تیم فنی تماس بگیرید
